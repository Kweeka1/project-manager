let postcss = require('postcss')

let IMPORTANT = /\s*!important\s*$/i

let UNITLESS = ***REMOVED***
  'box-flex': true,
  'box-flex-group': true,
  'column-count': true,
  'flex': true,
  'flex-grow': true,
  'flex-positive': true,
  'flex-shrink': true,
  'flex-negative': true,
  'font-weight': true,
  'line-clamp': true,
  'line-height': true,
  'opacity': true,
  'order': true,
  'orphans': true,
  'tab-size': true,
  'widows': true,
  'z-index': true,
  'zoom': true,
  'fill-opacity': true,
  'stroke-dashoffset': true,
  'stroke-opacity': true,
  'stroke-width': true
***REMOVED***

function dashify(str) ***REMOVED***
  return str
    .replace(/([A-Z])/g, '-$1')
    .replace(/^ms-/, '-ms-')
    .toLowerCase()
***REMOVED***

function decl(parent, name, value) ***REMOVED***
  if (value === false || value === null) return

  if (!name.startsWith('--')) ***REMOVED***
    name = dashify(name)
***REMOVED***

  if (typeof value === 'number') ***REMOVED***
    if (value === 0 || UNITLESS[name]) ***REMOVED***
      value = value.toString()
***REMOVED*** else ***REMOVED***
      value += 'px'
***REMOVED***
***REMOVED***

  if (name === 'css-float') name = 'float'

  if (IMPORTANT.test(value)) ***REMOVED***
    value = value.replace(IMPORTANT, '')
    parent.push(postcss.decl(***REMOVED*** prop: name, value, important: true ***REMOVED***))
***REMOVED*** else ***REMOVED***
    parent.push(postcss.decl(***REMOVED*** prop: name, value ***REMOVED***))
***REMOVED***
***REMOVED***

function atRule(parent, parts, value) ***REMOVED***
  let node = postcss.atRule(***REMOVED*** name: parts[1], params: parts[3] || '' ***REMOVED***)
  if (typeof value === 'object') ***REMOVED***
    node.nodes = []
    parse(value, node)
***REMOVED***
  parent.push(node)
***REMOVED***

function parse(obj, parent) ***REMOVED***
  let name, value, node
  for (name in obj) ***REMOVED***
    value = obj[name]
    if (value === null || typeof value === 'undefined') ***REMOVED***
      continue
***REMOVED*** else if (name[0] === '@') ***REMOVED***
      let parts = name.match(/@(\S+)(\s+([\W\w]*)\s*)?/)
      if (Array.isArray(value)) ***REMOVED***
        for (let i of value) ***REMOVED***
          atRule(parent, parts, i)
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
        atRule(parent, parts, value)
  ***REMOVED***
***REMOVED*** else if (Array.isArray(value)) ***REMOVED***
      for (let i of value) ***REMOVED***
        decl(parent, name, i)
  ***REMOVED***
***REMOVED*** else if (typeof value === 'object') ***REMOVED***
      node = postcss.rule(***REMOVED*** selector: name ***REMOVED***)
      parse(value, node)
      parent.push(node)
***REMOVED*** else ***REMOVED***
      decl(parent, name, value)
***REMOVED***
***REMOVED***
***REMOVED***

module.exports = function (obj) ***REMOVED***
  let root = postcss.root()
  parse(obj, root)
  return root
***REMOVED***
