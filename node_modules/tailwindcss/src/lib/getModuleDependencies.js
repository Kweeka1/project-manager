import fs from 'fs'
import path from 'path'
import resolve from 'resolve'
import detective from 'detective'

function createModule(file) ***REMOVED***
  const source = fs.readFileSync(file, 'utf-8')
  const requires = detective(source)

  return ***REMOVED*** file, requires ***REMOVED***
***REMOVED***

export default function getModuleDependencies(entryFile) ***REMOVED***
  const rootModule = createModule(entryFile)
  const modules = [rootModule]

  // Iterate over the modules, even when new
  // ones are being added
  for (const mdl of modules) ***REMOVED***
    mdl.requires
      .filter((dep) => ***REMOVED***
        // Only track local modules, not node_modules
        return dep.startsWith('./') || dep.startsWith('../')
  ***REMOVED***)
      .forEach((dep) => ***REMOVED***
        try ***REMOVED***
          const basedir = path.dirname(mdl.file)
          const depPath = resolve.sync(dep, ***REMOVED*** basedir ***REMOVED***)
          const depModule = createModule(depPath)

          modules.push(depModule)
    ***REMOVED*** catch (_err) ***REMOVED***
          // eslint-disable-next-line no-empty
    ***REMOVED***
  ***REMOVED***)
***REMOVED***

  return modules
***REMOVED***
