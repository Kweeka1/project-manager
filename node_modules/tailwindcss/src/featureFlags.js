import colors from 'picocolors'
import log from './util/log'

let defaults = ***REMOVED***
  optimizeUniversalDefaults: false,
***REMOVED***

let featureFlags = ***REMOVED***
  future: [],
  experimental: ['optimizeUniversalDefaults'],
***REMOVED***

export function flagEnabled(config, flag) ***REMOVED***
  if (featureFlags.future.includes(flag)) ***REMOVED***
    return config.future === 'all' || (config?.future?.[flag] ?? defaults[flag] ?? false)
***REMOVED***

  if (featureFlags.experimental.includes(flag)) ***REMOVED***
    return (
      config.experimental === 'all' || (config?.experimental?.[flag] ?? defaults[flag] ?? false)
    )
***REMOVED***

  return false
***REMOVED***

function experimentalFlagsEnabled(config) ***REMOVED***
  if (config.experimental === 'all') ***REMOVED***
    return featureFlags.experimental
***REMOVED***

  return Object.keys(config?.experimental ?? ***REMOVED******REMOVED***).filter(
    (flag) => featureFlags.experimental.includes(flag) && config.experimental[flag]
  )
***REMOVED***

export function issueFlagNotices(config) ***REMOVED***
  if (process.env.JEST_WORKER_ID !== undefined) ***REMOVED***
    return
***REMOVED***

  if (experimentalFlagsEnabled(config).length > 0) ***REMOVED***
    let changes = experimentalFlagsEnabled(config)
      .map((s) => colors.yellow(s))
      .join(', ')

    log.warn('experimental-flags-enabled', [
      `You have enabled experimental features: $***REMOVED***changes***REMOVED***`,
      'Experimental features in Tailwind CSS are not covered by semver, may introduce breaking changes, and can change at any time.',
    ])
***REMOVED***
***REMOVED***

export default featureFlags
