"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
const fsScandir = require("@nodelib/fs.scandir");
const common = require("./common");
const reader_1 = require("./reader");
class SyncReader extends reader_1.default ***REMOVED***
    constructor() ***REMOVED***
        super(...arguments);
        this._scandir = fsScandir.scandirSync;
        this._storage = [];
        this._queue = new Set();
***REMOVED***
    read() ***REMOVED***
        this._pushToQueue(this._root, this._settings.basePath);
        this._handleQueue();
        return this._storage;
***REMOVED***
    _pushToQueue(directory, base) ***REMOVED***
        this._queue.add(***REMOVED*** directory, base ***REMOVED***);
***REMOVED***
    _handleQueue() ***REMOVED***
        for (const item of this._queue.values()) ***REMOVED***
            this._handleDirectory(item.directory, item.base);
    ***REMOVED***
***REMOVED***
    _handleDirectory(directory, base) ***REMOVED***
        try ***REMOVED***
            const entries = this._scandir(directory, this._settings.fsScandirSettings);
            for (const entry of entries) ***REMOVED***
                this._handleEntry(entry, base);
        ***REMOVED***
    ***REMOVED***
        catch (error) ***REMOVED***
            this._handleError(error);
    ***REMOVED***
***REMOVED***
    _handleError(error) ***REMOVED***
        if (!common.isFatalError(this._settings, error)) ***REMOVED***
            return;
    ***REMOVED***
        throw error;
***REMOVED***
    _handleEntry(entry, base) ***REMOVED***
        const fullpath = entry.path;
        if (base !== undefined) ***REMOVED***
            entry.path = common.joinPathSegments(base, entry.name, this._settings.pathSegmentSeparator);
    ***REMOVED***
        if (common.isAppliedFilter(this._settings.entryFilter, entry)) ***REMOVED***
            this._pushToStorage(entry);
    ***REMOVED***
        if (entry.dirent.isDirectory() && common.isAppliedFilter(this._settings.deepFilter, entry)) ***REMOVED***
            this._pushToQueue(fullpath, base === undefined ? undefined : entry.path);
    ***REMOVED***
***REMOVED***
    _pushToStorage(entry) ***REMOVED***
        this._storage.push(entry);
***REMOVED***
***REMOVED***
exports.default = SyncReader;
