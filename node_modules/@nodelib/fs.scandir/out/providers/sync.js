"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
exports.readdir = exports.readdirWithFileTypes = exports.read = void 0;
const fsStat = require("@nodelib/fs.stat");
const constants_1 = require("../constants");
const utils = require("../utils");
const common = require("./common");
function read(directory, settings) ***REMOVED***
    if (!settings.stats && constants_1.IS_SUPPORT_READDIR_WITH_FILE_TYPES) ***REMOVED***
        return readdirWithFileTypes(directory, settings);
***REMOVED***
    return readdir(directory, settings);
***REMOVED***
exports.read = read;
function readdirWithFileTypes(directory, settings) ***REMOVED***
    const dirents = settings.fs.readdirSync(directory, ***REMOVED*** withFileTypes: true ***REMOVED***);
    return dirents.map((dirent) => ***REMOVED***
        const entry = ***REMOVED***
            dirent,
            name: dirent.name,
            path: common.joinPathSegments(directory, dirent.name, settings.pathSegmentSeparator)
    ***REMOVED***;
        if (entry.dirent.isSymbolicLink() && settings.followSymbolicLinks) ***REMOVED***
            try ***REMOVED***
                const stats = settings.fs.statSync(entry.path);
                entry.dirent = utils.fs.createDirentFromStats(entry.name, stats);
        ***REMOVED***
            catch (error) ***REMOVED***
                if (settings.throwErrorOnBrokenSymbolicLink) ***REMOVED***
                    throw error;
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***
        return entry;
***REMOVED***);
***REMOVED***
exports.readdirWithFileTypes = readdirWithFileTypes;
function readdir(directory, settings) ***REMOVED***
    const names = settings.fs.readdirSync(directory);
    return names.map((name) => ***REMOVED***
        const entryPath = common.joinPathSegments(directory, name, settings.pathSegmentSeparator);
        const stats = fsStat.statSync(entryPath, settings.fsStatSettings);
        const entry = ***REMOVED***
            name,
            path: entryPath,
            dirent: utils.fs.createDirentFromStats(name, stats)
    ***REMOVED***;
        if (settings.stats) ***REMOVED***
            entry.stats = stats;
    ***REMOVED***
        return entry;
***REMOVED***);
***REMOVED***
exports.readdir = readdir;
