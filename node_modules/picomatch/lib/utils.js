'use strict';

const path = require('path');
const win32 = process.platform === 'win32';
const ***REMOVED***
  REGEX_BACKSLASH,
  REGEX_REMOVE_BACKSLASH,
  REGEX_SPECIAL_CHARS,
  REGEX_SPECIAL_CHARS_GLOBAL
***REMOVED*** = require('./constants');

exports.isObject = val => val !== null && typeof val === 'object' && !Array.isArray(val);
exports.hasRegexChars = str => REGEX_SPECIAL_CHARS.test(str);
exports.isRegexChar = str => str.length === 1 && exports.hasRegexChars(str);
exports.escapeRegex = str => str.replace(REGEX_SPECIAL_CHARS_GLOBAL, '\\$1');
exports.toPosixSlashes = str => str.replace(REGEX_BACKSLASH, '/');

exports.removeBackslashes = str => ***REMOVED***
  return str.replace(REGEX_REMOVE_BACKSLASH, match => ***REMOVED***
    return match === '\\' ? '' : match;
***REMOVED***);
***REMOVED***;

exports.supportsLookbehinds = () => ***REMOVED***
  const segs = process.version.slice(1).split('.').map(Number);
  if (segs.length === 3 && segs[0] >= 9 || (segs[0] === 8 && segs[1] >= 10)) ***REMOVED***
    return true;
***REMOVED***
  return false;
***REMOVED***;

exports.isWindows = options => ***REMOVED***
  if (options && typeof options.windows === 'boolean') ***REMOVED***
    return options.windows;
***REMOVED***
  return win32 === true || path.sep === '\\';
***REMOVED***;

exports.escapeLast = (input, char, lastIdx) => ***REMOVED***
  const idx = input.lastIndexOf(char, lastIdx);
  if (idx === -1) return input;
  if (input[idx - 1] === '\\') return exports.escapeLast(input, char, idx - 1);
  return `$***REMOVED***input.slice(0, idx)***REMOVED***\\$***REMOVED***input.slice(idx)***REMOVED***`;
***REMOVED***;

exports.removePrefix = (input, state = ***REMOVED******REMOVED***) => ***REMOVED***
  let output = input;
  if (output.startsWith('./')) ***REMOVED***
    output = output.slice(2);
    state.prefix = './';
***REMOVED***
  return output;
***REMOVED***;

exports.wrapOutput = (input, state = ***REMOVED******REMOVED***, options = ***REMOVED******REMOVED***) => ***REMOVED***
  const prepend = options.contains ? '' : '^';
  const append = options.contains ? '' : '$';

  let output = `$***REMOVED***prepend***REMOVED***(?:$***REMOVED***input***REMOVED***)$***REMOVED***append***REMOVED***`;
  if (state.negated === true) ***REMOVED***
    output = `(?:^(?!$***REMOVED***output***REMOVED***).*$)`;
***REMOVED***
  return output;
***REMOVED***;
