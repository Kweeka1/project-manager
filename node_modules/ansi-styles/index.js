'use strict';

const wrapAnsi16 = (fn, offset) => (...args) => ***REMOVED***
	const code = fn(...args);
	return `\u001B[$***REMOVED***code + offset***REMOVED***m`;
***REMOVED***;

const wrapAnsi256 = (fn, offset) => (...args) => ***REMOVED***
	const code = fn(...args);
	return `\u001B[$***REMOVED***38 + offset***REMOVED***;5;$***REMOVED***code***REMOVED***m`;
***REMOVED***;

const wrapAnsi16m = (fn, offset) => (...args) => ***REMOVED***
	const rgb = fn(...args);
	return `\u001B[$***REMOVED***38 + offset***REMOVED***;2;$***REMOVED***rgb[0]***REMOVED***;$***REMOVED***rgb[1]***REMOVED***;$***REMOVED***rgb[2]***REMOVED***m`;
***REMOVED***;

const ansi2ansi = n => n;
const rgb2rgb = (r, g, b) => [r, g, b];

const setLazyProperty = (object, property, get) => ***REMOVED***
	Object.defineProperty(object, property, ***REMOVED***
		get: () => ***REMOVED***
			const value = get();

			Object.defineProperty(object, property, ***REMOVED***
				value,
				enumerable: true,
				configurable: true
			***REMOVED***);

			return value;
		***REMOVED***,
		enumerable: true,
		configurable: true
	***REMOVED***);
***REMOVED***;

/** @type ***REMOVED***typeof import('color-convert')***REMOVED*** */
let colorConvert;
const makeDynamicStyles = (wrap, targetSpace, identity, isBackground) => ***REMOVED***
	if (colorConvert === undefined) ***REMOVED***
		colorConvert = require('color-convert');
	***REMOVED***

	const offset = isBackground ? 10 : 0;
	const styles = ***REMOVED******REMOVED***;

	for (const [sourceSpace, suite] of Object.entries(colorConvert)) ***REMOVED***
		const name = sourceSpace === 'ansi16' ? 'ansi' : sourceSpace;
		if (sourceSpace === targetSpace) ***REMOVED***
			styles[name] = wrap(identity, offset);
		***REMOVED*** else if (typeof suite === 'object') ***REMOVED***
			styles[name] = wrap(suite[targetSpace], offset);
		***REMOVED***
	***REMOVED***

	return styles;
***REMOVED***;

function assembleStyles() ***REMOVED***
	const codes = new Map();
	const styles = ***REMOVED***
		modifier: ***REMOVED***
			reset: [0, 0],
			// 21 isn't widely supported and 22 does the same thing
			bold: [1, 22],
			dim: [2, 22],
			italic: [3, 23],
			underline: [4, 24],
			inverse: [7, 27],
			hidden: [8, 28],
			strikethrough: [9, 29]
		***REMOVED***,
		color: ***REMOVED***
			black: [30, 39],
			red: [31, 39],
			green: [32, 39],
			yellow: [33, 39],
			blue: [34, 39],
			magenta: [35, 39],
			cyan: [36, 39],
			white: [37, 39],

			// Bright color
			blackBright: [90, 39],
			redBright: [91, 39],
			greenBright: [92, 39],
			yellowBright: [93, 39],
			blueBright: [94, 39],
			magentaBright: [95, 39],
			cyanBright: [96, 39],
			whiteBright: [97, 39]
		***REMOVED***,
		bgColor: ***REMOVED***
			bgBlack: [40, 49],
			bgRed: [41, 49],
			bgGreen: [42, 49],
			bgYellow: [43, 49],
			bgBlue: [44, 49],
			bgMagenta: [45, 49],
			bgCyan: [46, 49],
			bgWhite: [47, 49],

			// Bright color
			bgBlackBright: [100, 49],
			bgRedBright: [101, 49],
			bgGreenBright: [102, 49],
			bgYellowBright: [103, 49],
			bgBlueBright: [104, 49],
			bgMagentaBright: [105, 49],
			bgCyanBright: [106, 49],
			bgWhiteBright: [107, 49]
		***REMOVED***
	***REMOVED***;

	// Alias bright black as gray (and grey)
	styles.color.gray = styles.color.blackBright;
	styles.bgColor.bgGray = styles.bgColor.bgBlackBright;
	styles.color.grey = styles.color.blackBright;
	styles.bgColor.bgGrey = styles.bgColor.bgBlackBright;

	for (const [groupName, group] of Object.entries(styles)) ***REMOVED***
		for (const [styleName, style] of Object.entries(group)) ***REMOVED***
			styles[styleName] = ***REMOVED***
				open: `\u001B[$***REMOVED***style[0]***REMOVED***m`,
				close: `\u001B[$***REMOVED***style[1]***REMOVED***m`
			***REMOVED***;

			group[styleName] = styles[styleName];

			codes.set(style[0], style[1]);
		***REMOVED***

		Object.defineProperty(styles, groupName, ***REMOVED***
			value: group,
			enumerable: false
		***REMOVED***);
	***REMOVED***

	Object.defineProperty(styles, 'codes', ***REMOVED***
		value: codes,
		enumerable: false
	***REMOVED***);

	styles.color.close = '\u001B[39m';
	styles.bgColor.close = '\u001B[49m';

	setLazyProperty(styles.color, 'ansi', () => makeDynamicStyles(wrapAnsi16, 'ansi16', ansi2ansi, false));
	setLazyProperty(styles.color, 'ansi256', () => makeDynamicStyles(wrapAnsi256, 'ansi256', ansi2ansi, false));
	setLazyProperty(styles.color, 'ansi16m', () => makeDynamicStyles(wrapAnsi16m, 'rgb', rgb2rgb, false));
	setLazyProperty(styles.bgColor, 'ansi', () => makeDynamicStyles(wrapAnsi16, 'ansi16', ansi2ansi, true));
	setLazyProperty(styles.bgColor, 'ansi256', () => makeDynamicStyles(wrapAnsi256, 'ansi256', ansi2ansi, true));
	setLazyProperty(styles.bgColor, 'ansi16m', () => makeDynamicStyles(wrapAnsi16m, 'rgb', rgb2rgb, true));

	return styles;
***REMOVED***

// Make the export immutable
Object.defineProperty(module, 'exports', ***REMOVED***
	enumerable: true,
	get: assembleStyles
***REMOVED***);
