let _fs
try ***REMOVED***
  _fs = require('graceful-fs')
***REMOVED*** catch (_) ***REMOVED***
  _fs = require('fs')
***REMOVED***
const universalify = require('universalify')
const ***REMOVED*** stringify, stripBom ***REMOVED*** = require('./utils')

async function _readFile (file, options = ***REMOVED******REMOVED***) ***REMOVED***
  if (typeof options === 'string') ***REMOVED***
    options = ***REMOVED*** encoding: options ***REMOVED***
***REMOVED***

  const fs = options.fs || _fs

  const shouldThrow = 'throws' in options ? options.throws : true

  let data = await universalify.fromCallback(fs.readFile)(file, options)

  data = stripBom(data)

  let obj
  try ***REMOVED***
    obj = JSON.parse(data, options ? options.reviver : null)
***REMOVED*** catch (err) ***REMOVED***
    if (shouldThrow) ***REMOVED***
      err.message = `$***REMOVED***file***REMOVED***: $***REMOVED***err.message***REMOVED***`
      throw err
***REMOVED*** else ***REMOVED***
      return null
***REMOVED***
***REMOVED***

  return obj
***REMOVED***

const readFile = universalify.fromPromise(_readFile)

function readFileSync (file, options = ***REMOVED******REMOVED***) ***REMOVED***
  if (typeof options === 'string') ***REMOVED***
    options = ***REMOVED*** encoding: options ***REMOVED***
***REMOVED***

  const fs = options.fs || _fs

  const shouldThrow = 'throws' in options ? options.throws : true

  try ***REMOVED***
    let content = fs.readFileSync(file, options)
    content = stripBom(content)
    return JSON.parse(content, options.reviver)
***REMOVED*** catch (err) ***REMOVED***
    if (shouldThrow) ***REMOVED***
      err.message = `$***REMOVED***file***REMOVED***: $***REMOVED***err.message***REMOVED***`
      throw err
***REMOVED*** else ***REMOVED***
      return null
***REMOVED***
***REMOVED***
***REMOVED***

async function _writeFile (file, obj, options = ***REMOVED******REMOVED***) ***REMOVED***
  const fs = options.fs || _fs

  const str = stringify(obj, options)

  await universalify.fromCallback(fs.writeFile)(file, str, options)
***REMOVED***

const writeFile = universalify.fromPromise(_writeFile)

function writeFileSync (file, obj, options = ***REMOVED******REMOVED***) ***REMOVED***
  const fs = options.fs || _fs

  const str = stringify(obj, options)
  // not sure if fs.writeFileSync returns anything, but just in case
  return fs.writeFileSync(file, str, options)
***REMOVED***

const jsonfile = ***REMOVED***
  readFile,
  readFileSync,
  writeFile,
  writeFileSync
***REMOVED***

module.exports = jsonfile
