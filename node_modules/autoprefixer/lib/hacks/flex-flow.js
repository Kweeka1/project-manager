let flexSpec = require('./flex-spec')
let Declaration = require('../declaration')

class FlexFlow extends Declaration ***REMOVED***
  /**
   * Use two properties for 2009 spec
   */
  insert(decl, prefix, prefixes) ***REMOVED***
    let spec
    ;[spec, prefix] = flexSpec(prefix)
    if (spec !== 2009) ***REMOVED***
      return super.insert(decl, prefix, prefixes)
***REMOVED***
    let values = decl.value
      .split(/\s+/)
      .filter(i => i !== 'wrap' && i !== 'nowrap' && 'wrap-reverse')
    if (values.length === 0) ***REMOVED***
      return undefined
***REMOVED***

    let already = decl.parent.some(
      i =>
        i.prop === prefix + 'box-orient' || i.prop === prefix + 'box-direction'
    )
    if (already) ***REMOVED***
      return undefined
***REMOVED***

    let value = values[0]
    let orient = value.includes('row') ? 'horizontal' : 'vertical'
    let dir = value.includes('reverse') ? 'reverse' : 'normal'

    let cloned = this.clone(decl)
    cloned.prop = prefix + 'box-orient'
    cloned.value = orient
    if (this.needCascade(decl)) ***REMOVED***
      cloned.raws.before = this.calcBefore(prefixes, decl, prefix)
***REMOVED***
    decl.parent.insertBefore(decl, cloned)

    cloned = this.clone(decl)
    cloned.prop = prefix + 'box-direction'
    cloned.value = dir
    if (this.needCascade(decl)) ***REMOVED***
      cloned.raws.before = this.calcBefore(prefixes, decl, prefix)
***REMOVED***
    return decl.parent.insertBefore(decl, cloned)
***REMOVED***
***REMOVED***

FlexFlow.names = ['flex-flow', 'box-direction', 'box-orient']

module.exports = FlexFlow
