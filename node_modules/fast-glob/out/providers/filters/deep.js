"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
const utils = require("../../utils");
const partial_1 = require("../matchers/partial");
class DeepFilter ***REMOVED***
    constructor(_settings, _micromatchOptions) ***REMOVED***
        this._settings = _settings;
        this._micromatchOptions = _micromatchOptions;
***REMOVED***
    getFilter(basePath, positive, negative) ***REMOVED***
        const matcher = this._getMatcher(positive);
        const negativeRe = this._getNegativePatternsRe(negative);
        return (entry) => this._filter(basePath, entry, matcher, negativeRe);
***REMOVED***
    _getMatcher(patterns) ***REMOVED***
        return new partial_1.default(patterns, this._settings, this._micromatchOptions);
***REMOVED***
    _getNegativePatternsRe(patterns) ***REMOVED***
        const affectDepthOfReadingPatterns = patterns.filter(utils.pattern.isAffectDepthOfReadingPattern);
        return utils.pattern.convertPatternsToRe(affectDepthOfReadingPatterns, this._micromatchOptions);
***REMOVED***
    _filter(basePath, entry, matcher, negativeRe) ***REMOVED***
        if (this._isSkippedByDeep(basePath, entry.path)) ***REMOVED***
            return false;
    ***REMOVED***
        if (this._isSkippedSymbolicLink(entry)) ***REMOVED***
            return false;
    ***REMOVED***
        const filepath = utils.path.removeLeadingDotSegment(entry.path);
        if (this._isSkippedByPositivePatterns(filepath, matcher)) ***REMOVED***
            return false;
    ***REMOVED***
        return this._isSkippedByNegativePatterns(filepath, negativeRe);
***REMOVED***
    _isSkippedByDeep(basePath, entryPath) ***REMOVED***
        /**
         * Avoid unnecessary depth calculations when it doesn't matter.
         */
        if (this._settings.deep === Infinity) ***REMOVED***
            return false;
    ***REMOVED***
        return this._getEntryLevel(basePath, entryPath) >= this._settings.deep;
***REMOVED***
    _getEntryLevel(basePath, entryPath) ***REMOVED***
        const entryPathDepth = entryPath.split('/').length;
        if (basePath === '') ***REMOVED***
            return entryPathDepth;
    ***REMOVED***
        const basePathDepth = basePath.split('/').length;
        return entryPathDepth - basePathDepth;
***REMOVED***
    _isSkippedSymbolicLink(entry) ***REMOVED***
        return !this._settings.followSymbolicLinks && entry.dirent.isSymbolicLink();
***REMOVED***
    _isSkippedByPositivePatterns(entryPath, matcher) ***REMOVED***
        return !this._settings.baseNameMatch && !matcher.match(entryPath);
***REMOVED***
    _isSkippedByNegativePatterns(entryPath, patternsRe) ***REMOVED***
        return !utils.pattern.matchAny(entryPath, patternsRe);
***REMOVED***
***REMOVED***
exports.default = DeepFilter;
