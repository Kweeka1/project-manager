"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
const stream_1 = require("stream");
const fsStat = require("@nodelib/fs.stat");
const fsWalk = require("@nodelib/fs.walk");
const reader_1 = require("./reader");
class ReaderStream extends reader_1.default ***REMOVED***
    constructor() ***REMOVED***
        super(...arguments);
        this._walkStream = fsWalk.walkStream;
        this._stat = fsStat.stat;
***REMOVED***
    dynamic(root, options) ***REMOVED***
        return this._walkStream(root, options);
***REMOVED***
    static(patterns, options) ***REMOVED***
        const filepaths = patterns.map(this._getFullEntryPath, this);
        const stream = new stream_1.PassThrough(***REMOVED*** objectMode: true ***REMOVED***);
        stream._write = (index, _enc, done) => ***REMOVED***
            return this._getEntry(filepaths[index], patterns[index], options)
                .then((entry) => ***REMOVED***
                if (entry !== null && options.entryFilter(entry)) ***REMOVED***
                    stream.push(entry);
            ***REMOVED***
                if (index === filepaths.length - 1) ***REMOVED***
                    stream.end();
            ***REMOVED***
                done();
        ***REMOVED***)
                .catch(done);
    ***REMOVED***;
        for (let i = 0; i < filepaths.length; i++) ***REMOVED***
            stream.write(i);
    ***REMOVED***
        return stream;
***REMOVED***
    _getEntry(filepath, pattern, options) ***REMOVED***
        return this._getStat(filepath)
            .then((stats) => this._makeEntry(stats, pattern))
            .catch((error) => ***REMOVED***
            if (options.errorFilter(error)) ***REMOVED***
                return null;
        ***REMOVED***
            throw error;
    ***REMOVED***);
***REMOVED***
    _getStat(filepath) ***REMOVED***
        return new Promise((resolve, reject) => ***REMOVED***
            this._stat(filepath, this._fsStatSettings, (error, stats) => ***REMOVED***
                return error === null ? resolve(stats) : reject(error);
        ***REMOVED***);
    ***REMOVED***);
***REMOVED***
***REMOVED***
exports.default = ReaderStream;
