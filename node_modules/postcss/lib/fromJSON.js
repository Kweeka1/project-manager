'use strict'

let Declaration = require('./declaration')
let PreviousMap = require('./previous-map')
let Comment = require('./comment')
let AtRule = require('./at-rule')
let Input = require('./input')
let Root = require('./root')
let Rule = require('./rule')

function fromJSON(json, inputs) ***REMOVED***
  if (Array.isArray(json)) return json.map(n => fromJSON(n))

  let ***REMOVED*** inputs: ownInputs, ...defaults ***REMOVED*** = json
  if (ownInputs) ***REMOVED***
    inputs = []
    for (let input of ownInputs) ***REMOVED***
      let inputHydrated = ***REMOVED*** ...input, __proto__: Input.prototype ***REMOVED***
      if (inputHydrated.map) ***REMOVED***
        inputHydrated.map = ***REMOVED***
          ...inputHydrated.map,
          __proto__: PreviousMap.prototype
    ***REMOVED***
  ***REMOVED***
      inputs.push(inputHydrated)
***REMOVED***
***REMOVED***
  if (defaults.nodes) ***REMOVED***
    defaults.nodes = json.nodes.map(n => fromJSON(n, inputs))
***REMOVED***
  if (defaults.source) ***REMOVED***
    let ***REMOVED*** inputId, ...source ***REMOVED*** = defaults.source
    defaults.source = source
    if (inputId != null) ***REMOVED***
      defaults.source.input = inputs[inputId]
***REMOVED***
***REMOVED***
  if (defaults.type === 'root') ***REMOVED***
    return new Root(defaults)
***REMOVED*** else if (defaults.type === 'decl') ***REMOVED***
    return new Declaration(defaults)
***REMOVED*** else if (defaults.type === 'rule') ***REMOVED***
    return new Rule(defaults)
***REMOVED*** else if (defaults.type === 'comment') ***REMOVED***
    return new Comment(defaults)
***REMOVED*** else if (defaults.type === 'atrule') ***REMOVED***
    return new AtRule(defaults)
***REMOVED*** else ***REMOVED***
    throw new Error('Unknown node type: ' + json.type)
***REMOVED***
***REMOVED***

module.exports = fromJSON
fromJSON.default = fromJSON
