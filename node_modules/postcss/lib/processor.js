'use strict'

let NoWorkResult = require('./no-work-result')
let LazyResult = require('./lazy-result')
let Document = require('./document')
let Root = require('./root')

class Processor ***REMOVED***
  constructor(plugins = []) ***REMOVED***
    this.version = '8.4.14'
    this.plugins = this.normalize(plugins)
***REMOVED***

  use(plugin) ***REMOVED***
    this.plugins = this.plugins.concat(this.normalize([plugin]))
    return this
***REMOVED***

  process(css, opts = ***REMOVED******REMOVED***) ***REMOVED***
    if (
      this.plugins.length === 0 &&
      typeof opts.parser === 'undefined' &&
      typeof opts.stringifier === 'undefined' &&
      typeof opts.syntax === 'undefined'
    ) ***REMOVED***
      return new NoWorkResult(this, css, opts)
***REMOVED*** else ***REMOVED***
      return new LazyResult(this, css, opts)
***REMOVED***
***REMOVED***

  normalize(plugins) ***REMOVED***
    let normalized = []
    for (let i of plugins) ***REMOVED***
      if (i.postcss === true) ***REMOVED***
        i = i()
  ***REMOVED*** else if (i.postcss) ***REMOVED***
        i = i.postcss
  ***REMOVED***

      if (typeof i === 'object' && Array.isArray(i.plugins)) ***REMOVED***
        normalized = normalized.concat(i.plugins)
  ***REMOVED*** else if (typeof i === 'object' && i.postcssPlugin) ***REMOVED***
        normalized.push(i)
  ***REMOVED*** else if (typeof i === 'function') ***REMOVED***
        normalized.push(i)
  ***REMOVED*** else if (typeof i === 'object' && (i.parse || i.stringify)) ***REMOVED***
        if (process.env.NODE_ENV !== 'production') ***REMOVED***
          throw new Error(
            'PostCSS syntaxes cannot be used as plugins. Instead, please use ' +
              'one of the syntax/parser/stringifier options as outlined ' +
              'in your PostCSS runner documentation.'
          )
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
        throw new Error(i + ' is not a PostCSS plugin')
  ***REMOVED***
***REMOVED***
    return normalized
***REMOVED***
***REMOVED***

module.exports = Processor
Processor.default = Processor

Root.registerProcessor(Processor)
Document.registerProcessor(Processor)
